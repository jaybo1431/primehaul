<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Settings - PrimeHaul OS</title>
    <link rel="stylesheet" href="/static/app.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>{{ company.company_name }}</h1>
            <p class="subtitle">Payment Settings</p>
        </div>

        <div class="card fade-in">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                <h2>Receive Customer Deposits</h2>
                <a href="/{{ company_slug }}/admin/dashboard" class="btn" style="background: #555; color: #fff;">
                    Back to Dashboard
                </a>
            </div>

            {% if request.query_params.get('connected') %}
            <div class="alert" style="background: rgba(46, 229, 157, 0.1); border-left: 4px solid #2ee59d; margin-bottom: 24px;">
                <p style="margin: 0; color: #2ee59d;">
                    ‚úì Stripe account connected successfully! You can now receive deposits directly.
                </p>
            </div>
            {% endif %}

            {% if request.query_params.get('error') %}
            <div class="alert" style="background: rgba(255, 80, 80, 0.1); border-left: 4px solid #ff5050; margin-bottom: 24px;">
                <p style="margin: 0; color: #ff5050;">Failed to connect Stripe account. Please try again.</p>
            </div>
            {% endif %}

            <p style="color: #888; margin-bottom: 24px;">
                Connect your Stripe account to receive customer deposits directly into your bank account. PrimeHaul never touches the money ‚Äî it goes straight to you.
            </p>

            <!-- Stripe Connect Status -->
            <div style="padding: 24px; border-radius: 12px; background: {% if connect_status.connected and connect_status.status == 'active' %}rgba(46,229,157,.1); border: 1px solid rgba(46,229,157,.3){% elif connect_status.connected %}rgba(96,165,250,.1); border: 1px solid rgba(96,165,250,.3){% else %}rgba(255,255,255,.05); border: 1px solid rgba(255,255,255,.1){% endif %}; margin-bottom: 24px;">

                {% if connect_status.connected and connect_status.status == 'active' %}
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                        <div style="width: 48px; height: 48px; background: rgba(46,229,157,.2); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px;">‚úì</div>
                        <div>
                            <div style="font-size: 18px; font-weight: 700; color: #2ee59d;">Connected</div>
                            <div style="font-size: 14px; color: #888;">Your Stripe account is ready to receive deposits</div>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 16px;">
                        <div style="padding: 12px; background: rgba(255,255,255,.05); border-radius: 8px;">
                            <div style="font-size: 12px; color: #888; margin-bottom: 4px;">Card Payments</div>
                            <div style="font-weight: 600; color: #2ee59d;">Enabled</div>
                        </div>
                        <div style="padding: 12px; background: rgba(255,255,255,.05); border-radius: 8px;">
                            <div style="font-size: 12px; color: #888; margin-bottom: 4px;">Payouts</div>
                            <div style="font-weight: 600; color: #2ee59d;">Enabled</div>
                        </div>
                    </div>

                {% elif connect_status.connected and connect_status.status == 'pending' %}
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                        <div style="width: 48px; height: 48px; background: rgba(96,165,250,.2); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px;">‚è≥</div>
                        <div>
                            <div style="font-size: 18px; font-weight: 700; color: #60a5fa;">Setup Incomplete</div>
                            <div style="font-size: 14px; color: #888;">Please complete your Stripe account setup</div>
                        </div>
                    </div>
                    <form method="post" action="/{{ company_slug }}/admin/payments/connect" style="margin-top: 16px;">
                        <button type="submit" class="btn" style="width: 100%;">Complete Setup</button>
                    </form>

                {% else %}
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                        <div style="width: 48px; height: 48px; background: rgba(255,255,255,.1); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px;">üí≥</div>
                        <div>
                            <div style="font-size: 18px; font-weight: 700;">Not Connected</div>
                            <div style="font-size: 14px; color: #888;">Connect Stripe to receive customer deposits</div>
                        </div>
                    </div>
                    <form method="post" action="/{{ company_slug }}/admin/payments/connect" style="margin-top: 16px;">
                        <button type="submit" class="btn" style="width: 100%;">Connect Stripe Account</button>
                    </form>
                    <p style="font-size: 12px; color: #666; margin-top: 12px; text-align: center;">
                        You'll be redirected to Stripe to securely connect your account
                    </p>
                {% endif %}
            </div>

            <!-- How it works -->
            <div style="margin-top: 32px;">
                <h3 style="margin-bottom: 16px;">How Deposits Work</h3>
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    <div style="display: flex; gap: 12px; align-items: flex-start;">
                        <div style="width: 28px; height: 28px; background: rgba(46,229,157,.15); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 700; color: #2ee59d; flex-shrink: 0;">1</div>
                        <div>
                            <div style="font-weight: 600;">Customer accepts quote</div>
                            <div style="font-size: 13px; color: #888;">After you approve their survey, they can accept the quote</div>
                        </div>
                    </div>
                    <div style="display: flex; gap: 12px; align-items: flex-start;">
                        <div style="width: 28px; height: 28px; background: rgba(46,229,157,.15); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 700; color: #2ee59d; flex-shrink: 0;">2</div>
                        <div>
                            <div style="font-weight: 600;">Customer pays 20% deposit</div>
                            <div style="font-size: 13px; color: #888;">They pay by card to confirm their booking</div>
                        </div>
                    </div>
                    <div style="display: flex; gap: 12px; align-items: flex-start;">
                        <div style="width: 28px; height: 28px; background: rgba(46,229,157,.15); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 700; color: #2ee59d; flex-shrink: 0;">3</div>
                        <div>
                            <div style="font-weight: 600;">Money goes directly to you</div>
                            <div style="font-size: 13px; color: #888;">Deposits land in your bank account via Stripe (minus Stripe fees)</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Credits & Usage -->
        <div class="card fade-in" style="margin-top: 24px;">
            <h2 style="margin-bottom: 16px;">Credits & Usage</h2>
            <p style="color: #888; margin-bottom: 24px;">
                {% if usage.is_partner %}
                Partner account ‚Äî unlimited surveys included.
                {% else %}
                Buy credit packs upfront. 1 credit = 1 survey.
                {% endif %}
            </p>

            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 24px;">
                <div style="padding: 20px; background: {% if usage.low_credits %}rgba(255,77,79,.1); border: 1px solid rgba(255,77,79,.3){% else %}rgba(46,229,157,.1); border: 1px solid rgba(46,229,157,.2){% endif %}; border-radius: 12px; text-align: center;">
                    <div style="font-size: 36px; font-weight: 800; color: {% if usage.low_credits %}#ff4d4f{% else %}#2ee59d{% endif %};">
                        {% if usage.is_partner %}‚àû{% else %}{{ usage.credits }}{% endif %}
                    </div>
                    <div style="font-size: 12px; color: #888; margin-top: 4px;">Credits Remaining</div>
                </div>
                <div style="padding: 20px; background: rgba(255,255,255,.05); border-radius: 12px; text-align: center;">
                    <div style="font-size: 36px; font-weight: 800; color: #fff;">{{ usage.surveys_used }}</div>
                    <div style="font-size: 12px; color: #888; margin-top: 4px;">Surveys Completed</div>
                </div>
            </div>

            {% if not usage.is_partner %}
            <!-- Credit Packs -->
            <div style="margin-top: 24px;">
                <h3 style="margin-bottom: 16px; font-size: 16px;">Buy More Credits</h3>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
                    {% for pack_id, pack in usage.packs.items() %}
                    <div style="padding: 16px; background: rgba(255,255,255,.05); border-radius: 12px; border: 1px solid rgba(255,255,255,.1);">
                        <div style="font-weight: 700; text-transform: capitalize; margin-bottom: 8px;">{{ pack_id }}</div>
                        <div style="font-size: 24px; font-weight: 800; color: #2ee59d;">{{ pack.price_display }}</div>
                        <div style="font-size: 13px; color: #888; margin-top: 4px;">{{ pack.credits }} credits ({{ pack.per_survey }}/survey)</div>
                    </div>
                    {% endfor %}
                </div>
                <div style="margin-top: 16px; text-align: center;">
                    <a href="/{{ company_slug }}/admin/buy-credits" class="btn btn-primary" style="display: inline-block;">Buy Credits</a>
                </div>
            </div>

            {% if usage.low_credits %}
            <div style="margin-top: 16px; padding: 16px; background: rgba(255,77,79,.1); border: 1px solid rgba(255,77,79,.3); border-radius: 12px;">
                <div style="font-weight: 600; color: #ff4d4f; margin-bottom: 8px;">Low credits warning</div>
                <div style="font-size: 13px; color: #888;">You have less than 3 credits remaining. Buy more to continue accepting surveys.</div>
            </div>
            {% endif %}
            {% endif %}
        </div>

        <div style="text-align: center; margin-top: 32px; color: #666; font-size: 13px;">
            <p>&copy; 2026 PrimeHaul OS. All rights reserved.</p>
        </div>
    </div>
</body>
</html>
