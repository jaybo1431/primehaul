<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pricing Configuration - PrimeHaul OS</title>
    <link rel="stylesheet" href="/static/app.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>{{ company.company_name }}</h1>
            <p class="subtitle">Pricing Configuration</p>
        </div>

        <!-- Onboarding Tips -->
        <div class="card fade-in" id="pricingOnboarding" style="background: linear-gradient(135deg, rgba(46,229,157,.12), rgba(46,229,157,.04)); border: 1px solid rgba(46,229,157,.3); margin-bottom: 24px; position: relative;">
            <button onclick="dismissPricingTips()" style="position:absolute; top:12px; right:12px; background:none; border:none; color:#888; cursor:pointer; font-size:20px; line-height:1;">&times;</button>
            <div style="font-size: 18px; font-weight: 700; color: #2ee59d; margin-bottom: 12px;">ðŸ’° How Pricing Works</div>
            <div style="color: #ccc; font-size: 14px; line-height: 1.7;">
                <p style="margin-bottom: 12px;">Your pricing rules are used to automatically calculate quotes when customers complete surveys. Here's what to set up:</p>
                <ul style="margin: 0; padding-left: 20px; color: #aaa;">
                    <li><strong style="color:#fff;">Price per CBM</strong> - Your rate per cubic meter (industry average: Â£30-50)</li>
                    <li><strong style="color:#fff;">Callout Fee</strong> - Fixed base charge for every job (covers travel, admin)</li>
                    <li><strong style="color:#fff;">Item Surcharges</strong> - Extra fees for bulky or fragile items</li>
                    <li><strong style="color:#fff;">Packing Materials</strong> - Prices for boxes, tape, paper if customer needs packing</li>
                    <li><strong style="color:#fff;">Estimate Range</strong> - Show customers a price range (e.g., Â£400-Â£500) to allow flexibility</li>
                </ul>
                <p style="margin-top: 12px; color: #2ee59d;"><strong>Tip:</strong> Start with industry averages, then adjust based on your costs and local competition.</p>
            </div>
        </div>
        <script>
            function dismissPricingTips() {
                document.getElementById('pricingOnboarding').style.display = 'none';
                localStorage.setItem('primehaul_pricing_tips_dismissed', 'true');
            }
            if (localStorage.getItem('primehaul_pricing_tips_dismissed') === 'true') {
                document.getElementById('pricingOnboarding').style.display = 'none';
            }
        </script>

        <div class="card fade-in">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                <h2>Custom Pricing Rules</h2>
                <a href="/{{ company_slug }}/admin/dashboard" class="btn" style="background: #555; color: #fff;">
                    Back to Dashboard
                </a>
            </div>

            {% if success %}
            <div class="alert" style="background: rgba(46, 229, 157, 0.1); border-left: 4px solid #2ee59d; margin-bottom: 24px;">
                <p style="margin: 0; color: #2ee59d;">
                    âœ“ Pricing configuration updated successfully
                </p>
            </div>
            {% endif %}

            {% if error %}
            <div class="alert alert-error">
                {{ error }}
            </div>
            {% endif %}

            <p style="color: #888; margin-bottom: 32px;">
                Configure your custom pricing rules. These rates will be used to calculate all quotes for your company.
            </p>

            <form method="POST" action="/{{ company_slug }}/admin/pricing" class="form">
                <!-- Base Pricing -->
                <div style="margin-bottom: 32px; padding-bottom: 32px; border-bottom: 1px solid #333;">
                    <h3 style="margin-bottom: 16px;">Base Pricing</h3>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                        <div class="form-group">
                            <label for="price_per_cbm">Price per CBM (Â£)</label>
                            <input
                                type="number"
                                id="price_per_cbm"
                                name="price_per_cbm"
                                step="0.01"
                                min="0"
                                required
                                value="{{ pricing.price_per_cbm }}"
                                placeholder="35.00"
                            >
                            <small style="color: #666; font-size: 12px;">
                                Cost per cubic meter of items
                            </small>
                        </div>

                        <div class="form-group">
                            <label for="callout_fee">Callout Fee (Â£)</label>
                            <input
                                type="number"
                                id="callout_fee"
                                name="callout_fee"
                                step="0.01"
                                min="0"
                                required
                                value="{{ pricing.callout_fee }}"
                                placeholder="250.00"
                            >
                            <small style="color: #666; font-size: 12px;">
                                Fixed base charge for all jobs
                            </small>
                        </div>
                    </div>
                </div>

                <!-- Item Surcharges -->
                <div style="margin-bottom: 32px; padding-bottom: 32px; border-bottom: 1px solid #333;">
                    <h3 style="margin-bottom: 16px;">Item Surcharges</h3>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                        <div class="form-group">
                            <label for="bulky_item_fee">Bulky Item Fee (Â£)</label>
                            <input
                                type="number"
                                id="bulky_item_fee"
                                name="bulky_item_fee"
                                step="0.01"
                                min="0"
                                required
                                value="{{ pricing.bulky_item_fee }}"
                                placeholder="25.00"
                            >
                            <small style="color: #666; font-size: 12px;">
                                Extra charge per bulky item (sofas, wardrobes, etc.)
                            </small>
                        </div>

                        <div class="form-group">
                            <label for="fragile_item_fee">Fragile Item Fee (Â£)</label>
                            <input
                                type="number"
                                id="fragile_item_fee"
                                name="fragile_item_fee"
                                step="0.01"
                                min="0"
                                required
                                value="{{ pricing.fragile_item_fee }}"
                                placeholder="15.00"
                            >
                            <small style="color: #666; font-size: 12px;">
                                Extra charge per fragile item requiring special care
                            </small>
                        </div>
                    </div>
                </div>

                <!-- Weight-Based Pricing -->
                <div style="margin-bottom: 32px; padding-bottom: 32px; border-bottom: 1px solid #333;">
                    <h3 style="margin-bottom: 16px;">Weight-Based Pricing</h3>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                        <div class="form-group">
                            <label for="weight_threshold_kg">Weight Threshold (kg)</label>
                            <input
                                type="number"
                                id="weight_threshold_kg"
                                name="weight_threshold_kg"
                                step="1"
                                min="0"
                                required
                                value="{{ pricing.weight_threshold_kg }}"
                                placeholder="1000"
                            >
                            <small style="color: #666; font-size: 12px;">
                                Threshold before additional weight charges apply
                            </small>
                        </div>

                        <div class="form-group">
                            <label for="price_per_kg_over_threshold">Price per kg Over Threshold (Â£)</label>
                            <input
                                type="number"
                                id="price_per_kg_over_threshold"
                                name="price_per_kg_over_threshold"
                                step="0.01"
                                min="0"
                                required
                                value="{{ pricing.price_per_kg_over_threshold }}"
                                placeholder="0.50"
                            >
                            <small style="color: #666; font-size: 12px;">
                                Additional cost per kg over the threshold
                            </small>
                        </div>
                    </div>
                </div>

                <!-- Packing Materials Pricing -->
                <div style="margin-bottom: 32px; padding-bottom: 32px; border-bottom: 1px solid #333;">
                    <h3 style="margin-bottom: 16px;">Packing Materials Pricing</h3>
                    <p style="color: #888; font-size: 14px; margin-bottom: 16px;">
                        Set prices for boxes, tape, paper, and other packing materials.
                    </p>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                        <div class="form-group">
                            <label for="pack1_price">Small Box (18Ã—18Ã—10") - Â£</label>
                            <input
                                type="number"
                                id="pack1_price"
                                name="pack1_price"
                                step="0.01"
                                min="0"
                                required
                                value="{{ pricing.pack1_price }}"
                                placeholder="1.05"
                            >
                            <small style="color: #666; font-size: 12px;">
                                For books, heavy items
                            </small>
                        </div>

                        <div class="form-group">
                            <label for="pack2_price">Medium Box (18Ã—18Ã—20") - Â£</label>
                            <input
                                type="number"
                                id="pack2_price"
                                name="pack2_price"
                                step="0.01"
                                min="0"
                                required
                                value="{{ pricing.pack2_price }}"
                                placeholder="1.55"
                            >
                            <small style="color: #666; font-size: 12px;">
                                For kitchen items, clothes
                            </small>
                        </div>

                        <div class="form-group">
                            <label for="pack3_price">Large Box (18Ã—18Ã—30") - Â£</label>
                            <input
                                type="number"
                                id="pack3_price"
                                name="pack3_price"
                                step="0.01"
                                min="0"
                                required
                                value="{{ pricing.pack3_price }}"
                                placeholder="2.00"
                            >
                            <small style="color: #666; font-size: 12px;">
                                For linens, bedding, cushions
                            </small>
                        </div>

                        <div class="form-group">
                            <label for="pack6_price">Extra Small Box (18Ã—13Ã—13") - Â£</label>
                            <input
                                type="number"
                                id="pack6_price"
                                name="pack6_price"
                                step="0.01"
                                min="0"
                                required
                                value="{{ pricing.pack6_price }}"
                                placeholder="1.05"
                            >
                            <small style="color: #666; font-size: 12px;">
                                For small, fragile items
                            </small>
                        </div>

                        <div class="form-group">
                            <label for="robe_carton_price">Wardrobe Carton (20Ã—18Ã—48") - Â£</label>
                            <input
                                type="number"
                                id="robe_carton_price"
                                name="robe_carton_price"
                                step="0.01"
                                min="0"
                                required
                                value="{{ pricing.robe_carton_price }}"
                                placeholder="10.00"
                            >
                            <small style="color: #666; font-size: 12px;">
                                For hanging clothes (1 per wardrobe door)
                            </small>
                        </div>

                        <div class="form-group">
                            <label for="mattress_cover_price">Mattress Cover (King) - Â£</label>
                            <input
                                type="number"
                                id="mattress_cover_price"
                                name="mattress_cover_price"
                                step="0.01"
                                min="0"
                                required
                                value="{{ pricing.mattress_cover_price }}"
                                placeholder="1.74"
                            >
                            <small style="color: #666; font-size: 12px;">
                                Protective cover per mattress
                            </small>
                        </div>

                        <div class="form-group">
                            <label for="tape_price">Packing Tape (per roll) - Â£</label>
                            <input
                                type="number"
                                id="tape_price"
                                name="tape_price"
                                step="0.01"
                                min="0"
                                required
                                value="{{ pricing.tape_price }}"
                                placeholder="1.14"
                            >
                            <small style="color: #666; font-size: 12px;">
                                1 roll per 10 boxes
                            </small>
                        </div>

                        <div class="form-group">
                            <label for="paper_price">Packing Paper (per pack) - Â£</label>
                            <input
                                type="number"
                                id="paper_price"
                                name="paper_price"
                                step="0.01"
                                min="0"
                                required
                                value="{{ pricing.paper_price }}"
                                placeholder="7.50"
                            >
                            <small style="color: #666; font-size: 12px;">
                                1.5 packs per 10 CBM
                            </small>
                        </div>
                    </div>
                </div>

                <!-- Packing Service Labor -->
                <div style="margin-bottom: 32px; padding-bottom: 32px; border-bottom: 1px solid #333;">
                    <h3 style="margin-bottom: 16px;">Packing Service Labor</h3>
                    <p style="color: #888; font-size: 14px; margin-bottom: 16px;">
                        Set hourly rate for professional packing service.
                    </p>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                        <div class="form-group">
                            <label for="packing_labor_per_hour">Packing Labor (per hour) - Â£</label>
                            <input
                                type="number"
                                id="packing_labor_per_hour"
                                name="packing_labor_per_hour"
                                step="0.01"
                                min="0"
                                required
                                value="{{ pricing.packing_labor_per_hour }}"
                                placeholder="40.00"
                            >
                            <small style="color: #666; font-size: 12px;">
                                Hourly rate for professional packing (materials included)
                            </small>
                        </div>

                        <div style="padding: 16px; background: rgba(46, 229, 157, 0.05); border: 1px solid rgba(46, 229, 157, 0.2); border-radius: 8px;">
                            <div style="font-size: 13px; color: #2ee59d; font-weight: 600; margin-bottom: 6px;">
                                Packing Rates
                            </div>
                            <div style="font-size: 12px; color: #aaa; line-height: 1.6;">
                                â€¢ Kitchen: ~15 items/hour (fragile)<br>
                                â€¢ Other rooms: ~20 items/hour<br>
                                â€¢ Minimum: 30 min per room
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Estimate Range -->
                <div style="margin-bottom: 32px;">
                    <h3 style="margin-bottom: 16px;">Estimate Range Multipliers</h3>
                    <p style="color: #888; font-size: 14px; margin-bottom: 16px;">
                        These multipliers determine the price range shown to customers.
                    </p>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                        <div class="form-group">
                            <label for="estimate_low_multiplier">Low Estimate Multiplier</label>
                            <input
                                type="number"
                                id="estimate_low_multiplier"
                                name="estimate_low_multiplier"
                                step="0.01"
                                min="0"
                                max="2"
                                required
                                value="{{ pricing.estimate_low_multiplier }}"
                                placeholder="0.85"
                            >
                            <small style="color: #666; font-size: 12px;">
                                Default: 0.85 (15% below base price)
                            </small>
                        </div>

                        <div class="form-group">
                            <label for="estimate_high_multiplier">High Estimate Multiplier</label>
                            <input
                                type="number"
                                id="estimate_high_multiplier"
                                name="estimate_high_multiplier"
                                step="0.01"
                                min="1"
                                max="3"
                                required
                                value="{{ pricing.estimate_high_multiplier }}"
                                placeholder="1.15"
                            >
                            <small style="color: #666; font-size: 12px;">
                                Default: 1.15 (15% above base price)
                            </small>
                        </div>
                    </div>
                </div>

                <!-- Example Calculation -->
                <div style="background: #222; padding: 24px; border-radius: 8px; margin-bottom: 24px;">
                    <h4 style="margin: 0 0 16px 0; color: #2ee59d;">Example Calculation</h4>
                    <div style="color: #aaa; font-size: 14px; line-height: 1.8;">
                        <div style="margin-bottom: 8px;">
                            <strong>Scenario:</strong> 2-bedroom flat, 15 CBM, 800kg, 2 bulky items, 3 fragile items
                        </div>
                        <div style="margin: 16px 0; padding: 12px; background: #1a1a1a; border-radius: 4px; font-family: monospace;">
                            Callout Fee: Â£<span id="calc_callout">250</span><br>
                            Volume: <span id="calc_cbm">15</span> CBM Ã— Â£<span id="calc_cbm_rate">35</span> = Â£<span id="calc_cbm_total">525</span><br>
                            Bulky Items: <span id="calc_bulky">2</span> Ã— Â£<span id="calc_bulky_rate">25</span> = Â£<span id="calc_bulky_total">50</span><br>
                            Fragile Items: <span id="calc_fragile">3</span> Ã— Â£<span id="calc_fragile_rate">15</span> = Â£<span id="calc_fragile_total">45</span><br>
                            Weight Surcharge: Â£<span id="calc_weight">0</span> (under threshold)<br>
                            <hr style="border: none; border-top: 1px solid #333; margin: 8px 0;">
                            <strong>Base Total: Â£<span id="calc_base">870</span></strong><br>
                            <strong style="color: #2ee59d;">Estimate Range: Â£<span id="calc_low">740</span> - Â£<span id="calc_high">1,001</span></strong>
                        </div>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary btn-block">
                    Save Pricing Configuration
                </button>
            </form>
        </div>

        <div style="text-align: center; margin-top: 32px; color: #666; font-size: 13px;">
            <p>&copy; 2025 PrimeHaul OS. All rights reserved.</p>
        </div>
    </div>

    <script>
        // Live calculation updates
        const fields = {
            callout_fee: document.getElementById('callout_fee'),
            price_per_cbm: document.getElementById('price_per_cbm'),
            bulky_item_fee: document.getElementById('bulky_item_fee'),
            fragile_item_fee: document.getElementById('fragile_item_fee'),
            estimate_low_multiplier: document.getElementById('estimate_low_multiplier'),
            estimate_high_multiplier: document.getElementById('estimate_high_multiplier'),
        };

        function updateCalculation() {
            const callout = parseFloat(fields.callout_fee.value) || 0;
            const cbmRate = parseFloat(fields.price_per_cbm.value) || 0;
            const bulkyRate = parseFloat(fields.bulky_item_fee.value) || 0;
            const fragileRate = parseFloat(fields.fragile_item_fee.value) || 0;
            const lowMult = parseFloat(fields.estimate_low_multiplier.value) || 0.85;
            const highMult = parseFloat(fields.estimate_high_multiplier.value) || 1.15;

            const cbmTotal = 15 * cbmRate;
            const bulkyTotal = 2 * bulkyRate;
            const fragileTotal = 3 * fragileRate;
            const baseTotal = callout + cbmTotal + bulkyTotal + fragileTotal;
            const lowEstimate = Math.round(baseTotal * lowMult);
            const highEstimate = Math.round(baseTotal * highMult);

            document.getElementById('calc_callout').textContent = callout.toFixed(0);
            document.getElementById('calc_cbm_rate').textContent = cbmRate.toFixed(0);
            document.getElementById('calc_cbm_total').textContent = cbmTotal.toFixed(0);
            document.getElementById('calc_bulky_rate').textContent = bulkyRate.toFixed(0);
            document.getElementById('calc_bulky_total').textContent = bulkyTotal.toFixed(0);
            document.getElementById('calc_fragile_rate').textContent = fragileRate.toFixed(0);
            document.getElementById('calc_fragile_total').textContent = fragileTotal.toFixed(0);
            document.getElementById('calc_base').textContent = baseTotal.toFixed(0);
            document.getElementById('calc_low').textContent = lowEstimate.toLocaleString();
            document.getElementById('calc_high').textContent = highEstimate.toLocaleString();
        }

        // Add event listeners
        Object.values(fields).forEach(field => {
            field.addEventListener('input', updateCalculation);
        });

        // Initial calculation
        updateCalculation();
    </script>
</body>
</html>
